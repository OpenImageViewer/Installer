<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <?include "config.wxi"?>
    <Product Id="*" Name="Open Image Viewer" Language="1033" Version="0.1.25" Manufacturer="OIV" UpgradeCode="C16E0BCE-9B7A-44F1-897C-DBAD4C577CF3">
        <Package Id="*" Description="Open Image Viewer" Comments="Probably the fastest viewer on earth and maybe even in the galaxy" InstallerVersion="200" Compressed="yes" InstallPrivileges="limited" />
        <MajorUpgrade AllowDowngrades="yes" AllowSameVersionUpgrades="no" />
        <Media Id="1" Cabinet="oiv.cab" EmbedCab="yes" />
        <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
        <UIRef Id="WixUI_InstallDir" />
        <Property Id="ARPPRODUCTICON" Value="UninstallIcon.exe" />
        <Property Id="WIXUI_INSTALLDIR" Value="OIV_Folder" />
        <Icon Id="UninstallIcon.exe" SourceFile="$(var.SourceDir)\OIViewer.exe" />
        <Icon Id="DesktopIcon.exe" SourceFile="$(var.SourceDir)\OIViewer.exe" />
        <Icon Id="StartMenuIcon.exe" SourceFile="$(var.SourceDir)\OIViewer.exe" />
        <!-- https://stackoverflow.com/questions/4658220/create-shortcut-checkbox -->
        <!-- <UI>
            <Dialog Id="InstallDirAndOptionalShortcutDlg" Width="400" Height="300">
                <Control Id="InstallShortcutCheckbox" Type="CheckBox" X="20" Y="140" Width="200" Height="17" Property="INSTALLSHORTCUT" CheckBoxValue="1" Text="Do you want to create a start menu shortcut?" />
            </Dialog>
        </UI> -->
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="LocalAppDataFolder" Name="AppData">
                <Directory Id="OIV_Folder" Name="Open Image Viewer">
                    <Component Id="FREEIMAGE.DLL" DiskId="1" Guid="5F7B78A5-306E-478F-A553-1EB0064A4A4D">
                        <File Id="FREEIMAGE.DLL" Name="FreeImage.dll" Source="$(var.SourceDir)\FreeImage.dll" />
                    </Component>
                    <Component Id="LIBPNG16.DLL" DiskId="1" Guid="A663D60C-989C-4F07-8827-4082DD498020">
                        <File Id="LIBPNG16.DLL" Name="libpng16.dll" Source="$(var.SourceDir)\libpng16.dll" />
                    </Component>
                    <Component Id="OIV.DLL" DiskId="1" Guid="7E2FDCE7-EF3C-4538-BA6F-C788320095AD">
                        <File Id="OIV.DLL" Name="oiv.dll" Source="$(var.SourceDir)\oiv.dll" />
                    </Component>
                    <Component Id="OIVIEWER.EXE" DiskId="1" Guid="FB53BAB3-CA21-4BE0-9359-0CAD08636C71">
                        <File Id="OIVIEWER.EXE" Name="OIViewer.exe" Source="$(var.SourceDir)\OIViewer.exe">
                            <Shortcut Id="desktopShortcut" Directory="DesktopFolder" Name="Open Image Viewer" WorkingDirectory="INSTALLDIR" Advertise="yes" Icon="DesktopIcon.exe" IconIndex="0" />
                            <Shortcut Id="ExeShortcut" Directory="ProgramMenuDir" Name="Open Image Viewer" Advertise="yes" Icon="StartMenuIcon.exe" IconIndex="0" />
                        </File>
                    </Component>
                    <Component Id="TURBOJPEG.DLL" DiskId="1" Guid="4E1D3052-ABE2-4499-BF12-6ABDA23EF381">
                        <File Id="TURBOJPEG.DLL" Name="turbojpeg.dll" Source="$(var.SourceDir)\turbojpeg.dll" />
                    </Component>
                    <Directory Id="RESOURCES" Name="Resources">
                        <Directory Id="CURSORS" Name="Cursors">
                            <Component Id="ARROW_C.CUR" DiskId="1" Guid="E1C367E5-FE6F-48D5-A4EE-0C1C91C9B358">
                                <File Id="ARROW_C.CUR" Name="arrow-C.cur" Source="$(var.SourceDir)\Resources\Cursors\arrow-C.cur" />
                            </Component>
                            <Component Id="ARROW_E.CUR" DiskId="1" Guid="37652AB5-D485-41FA-AE6E-4CA9E47AA8B2">
                                <File Id="ARROW_E.CUR" Name="arrow-E.cur" Source="$(var.SourceDir)\Resources\Cursors\arrow-E.cur" />
                            </Component>
                            <Component Id="ARROW_N.CUR" DiskId="1" Guid="014286F9-F791-460D-843F-92D9C2049B6E">
                                <File Id="ARROW_N.CUR" Name="arrow-N.cur" Source="$(var.SourceDir)\Resources\Cursors\arrow-N.cur" />
                            </Component>
                            <Component Id="ARROW_NE.CUR" DiskId="1" Guid="745F2155-3741-43C6-95E5-87502619CCBA">
                                <File Id="ARROW_NE.CUR" Name="arrow-NE.cur" Source="$(var.SourceDir)\Resources\Cursors\arrow-NE.cur" />
                            </Component>
                            <Component Id="ARROW_NW.CUR" DiskId="1" Guid="BFECEB8F-3E52-443C-AAFA-7EA986EA8BB8">
                                <File Id="ARROW_NW.CUR" Name="arrow-NW.cur" Source="$(var.SourceDir)\Resources\Cursors\arrow-NW.cur" />
                            </Component>
                            <Component Id="ARROW_S.CUR" DiskId="1" Guid="4C9030A9-3BBE-4287-B5AD-E373481216B8">
                                <File Id="ARROW_S.CUR" Name="arrow-S.cur" Source="$(var.SourceDir)\Resources\Cursors\arrow-S.cur" />
                            </Component>
                            <Component Id="ARROW_SE.CUR" DiskId="1" Guid="E5F87F3A-7B10-470E-8E97-B72851088F79">
                                <File Id="ARROW_SE.CUR" Name="arrow-SE.cur" Source="$(var.SourceDir)\Resources\Cursors\arrow-SE.cur" />
                            </Component>
                            <Component Id="ARROW_SW.CUR" DiskId="1" Guid="4358CCCE-CDBF-4617-A51E-33A9A6FB2E71">
                                <File Id="ARROW_SW.CUR" Name="arrow-SW.cur" Source="$(var.SourceDir)\Resources\Cursors\arrow-SW.cur" />
                            </Component>
                            <Component Id="ARROW_W.CUR" DiskId="1" Guid="31EF641D-7B90-4983-9C63-83098BC0B57D">
                                <File Id="ARROW_W.CUR" Name="arrow-W.cur" Source="$(var.SourceDir)\Resources\Cursors\arrow-W.cur" />
                            </Component>
                        </Directory>
                        <Directory Id="PROGRAMS" Name="programs">
                            <Component Id="COLORCORRECTION.SHADER" DiskId="1" Guid="FC440842-0F90-4DB0-99A9-E3F141687154">
                                <File Id="COLORCORRECTION.SHADER" Name="colorCorrection.shader" Source="$(var.SourceDir)\Resources\programs\colorCorrection.shader" />
                            </Component>
                            <Component Id="IMAGECOMMON.SHADER" DiskId="1" Guid="D38C23C1-B954-4E7C-A020-03B2CDD6024D">
                                <File Id="IMAGECOMMON.SHADER" Name="imagecommon.shader" Source="$(var.SourceDir)\Resources\programs\imagecommon.shader" />
                            </Component>
                            <Component Id="QUAD_FP.SHADER" DiskId="1" Guid="D7A60A6D-9020-4C1B-88A3-1F59B9FE6848">
                                <File Id="QUAD_FP.SHADER" Name="quad_fp.shader" Source="$(var.SourceDir)\Resources\programs\quad_fp.shader" />
                            </Component>
                            <Component Id="QUAD_SELECTION_FP.SHADER" DiskId="1" Guid="6400B722-D2A2-4F54-98AA-FC5FA2164BDC">
                                <File Id="QUAD_SELECTION_FP.SHADER" Name="quad_selection_fp.shader" Source="$(var.SourceDir)\Resources\programs\quad_selection_fp.shader" />
                            </Component>
                            <Component Id="QUAD_SIMPLE_FP.SHADER" DiskId="1" Guid="2565ED06-3BC9-4660-AA10-CF1D28FD5D99">
                                <File Id="QUAD_SIMPLE_FP.SHADER" Name="quad_simple_fp.shader" Source="$(var.SourceDir)\Resources\programs\quad_simple_fp.shader" />
                            </Component>
                            <Component Id="QUAD_VP.SHADER" DiskId="1" Guid="9D2DC8C9-7DA9-4623-8F58-B2D8EE516F38">
                                <File Id="QUAD_VP.SHADER" Name="quad_vp.shader" Source="$(var.SourceDir)\Resources\programs\quad_vp.shader" />
                            </Component>
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="DesktopFolder" />
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ProgramMenuDir" Name="Open Image Viewer">
                    <Component Id="StartMenuShortcuts" Guid="99C59691-F493-4DD8-8973-F500DA05D528">
                        <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
                        <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\[ProductName]" Type="string" Value="" />
                        <Shortcut Id="UninstallProduct" Name="Uninstall Open Image Viewer" Description="Uninstalls the Open Image Viewer application" Target="[System64Folder]msiexec.exe" Arguments="/x [ProductCode]" />
                    </Component>
                </Directory>
            </Directory>
        </Directory>
        <!-- <DirectoryRef Id="OIV_Folder">
            <Component Id="Registration.xml" Guid="f671ee4d-dd0a-4f7f-a4d1-1d181d2f3002" DiskId="1">
                <CreateFolder/>
                <RemoveFolder Id="RemoveAppRootDirectory" On="uninstall" />
                <RegistryKey Root="HKCU" Key="Software\MyCompany\MyApplication" Action="createAndRemoveOnUninstall">
                    <RegistryValue Name="Version" Value="[ProductVersion]" Type="string" KeyPath="yes"/>
                </RegistryKey>
            </Component>
        </DirectoryRef> -->
        <Feature Id="DefaultFeature" Title="Main Feature" Level="1">
            <ComponentRef Id="FREEIMAGE.DLL" />
            <ComponentRef Id="LIBPNG16.DLL" />
            <ComponentRef Id="OIV.DLL" />
            <ComponentRef Id="OIVIEWER.EXE" />
            <ComponentRef Id="TURBOJPEG.DLL" />
            <ComponentRef Id="ARROW_C.CUR" />
            <ComponentRef Id="ARROW_E.CUR" />
            <ComponentRef Id="ARROW_N.CUR" />
            <ComponentRef Id="ARROW_NE.CUR" />
            <ComponentRef Id="ARROW_NW.CUR" />
            <ComponentRef Id="ARROW_S.CUR" />
            <ComponentRef Id="ARROW_SE.CUR" />
            <ComponentRef Id="ARROW_SW.CUR" />
            <ComponentRef Id="ARROW_W.CUR" />
            <ComponentRef Id="COLORCORRECTION.SHADER" />
            <ComponentRef Id="IMAGECOMMON.SHADER" />
            <ComponentRef Id="QUAD_FP.SHADER" />
            <ComponentRef Id="QUAD_SELECTION_FP.SHADER" />
            <ComponentRef Id="QUAD_SIMPLE_FP.SHADER" />
            <ComponentRef Id="QUAD_VP.SHADER" />
            <ComponentRef Id="StartMenuShortcuts" />
        </Feature>
        <UI />
    </Product>
</Wix>